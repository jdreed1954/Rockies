---
title: 'Rockies 2017 - Week #2A'
author: "Jim Reed (jdreed@q.com)"
date: "April 17, 2017"
output:
  pdf_document: default
  html_notebook: default
  html_document: default
  fontsize: 12pt
---
\centerline{\includegraphics[width=6.0in]{images/rockies_home_opener.jpg}}

## Introduction
Note, I discovered that I had inadvertently numbered these articles starting with _Wk1_ before the start of the season.  This report should be numbered _Wk2_ but since last week's already has that label, and to get us back on track number the articles as _Wkn_ designating the review of the _nth_ week of the season, I will label this as _Wk2A_.  Hereafter, we will number the weeks _Wk3_, _Wk4_, ... 

This week we will continue to develop a Rockies Dashboard of performance and progress for the season.  Presented here are the following:

* National and American League Standings
* Game-by-Game Results of the past week.
* Colorado Rockies batting statistics in rank order.
* Pythagorean Theorem prediction of the number of wins by end of the season based on the number of runs scored (R) and the number of runs allowed (RA).
* Colorado Rockies Pitching Statistics

The source data for this article can be found at URL [http://baseball-reference.com](http://baseball-reference.com).

In the future I would like to add other statistics having to do with pitching and other defense-related measures.  I am open to input on this.  If there are favorite pitching or fielding measurements you would like to see, let me know.

```{r Init, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(Lahman)
library(XML)
library(RCurl)
library(rlist)

source("../Baseball/Baseball_Functions.r")
```


\newpage

# [National League Standings](http://www.baseball-reference.com/leagues/NL/2017-standings.shtml#expanded_standings_W::none)


```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
theurl <- getURL("http://www.baseball-reference.com/leagues/NL/2017-standings.shtml#expanded_standings_W::none")
tables <- readHTMLTable(theurl)
tables <- list.clean(tables, fun = is.null, recursive = FALSE)
n.rows <- unlist(lapply(tables, function(t) dim(t)[1]))
knitr::kable(tables$standings_E, caption = "NL East Standings")
knitr::kable(tables$standings_C, caption = "NL Central Standings")
knitr::kable(tables$standings_W, caption = "NL West Standings")

```

\newpage

# [American League Standings](http://www.baseball-reference.com/leagues/AL/2017-standings.shtml#expanded_standings_W::none)

```{r, echo=FALSE, message=FALSE, warning=FALSE, results = 'asis'}

ALurl <- getURL("http://www.baseball-reference.com/leagues/AL/2017-standings.shtml#expanded_standings_W::none")
ALStandings <- readHTMLTable(ALurl)
ALStandings <- list.clean(ALStandings, fun = is.null, recursive = FALSE)
n.rows <- unlist(lapply(ALStandings, function(t) dim(t)[1]))
knitr::kable(ALStandings$standings_E, caption = "AL East Standings")
knitr::kable(ALStandings$standings_C, caption = "AL Central Standings")
knitr::kable(ALStandings$standings_W, caption = "AL West Standings")
```





\newpage

## Rockies Game-by-Game Schedule/Results

```{r, echo=FALSE, message=FALSE, warning=FALSE}
GBG <- getRockies17GBG()
knitr::kable(GBG)
```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
WINS <- sum(GBG$`W/L` == "W")
LOSSES <-  sum(GBG$`W/L` == "L")
WPCT <- WINS/(WINS + LOSSES)
TotalR <- sum(as.integer(GBG$R))
TotalRA <- sum(as.integer(GBG$RA))
```


The Rockies current record is `r WINS` Wins and `r LOSSES` Losses.  So far, the Rockies have scored `r TotalR` runs and have had `r TotalRA` runs scored against them.

\newpage

## 2017 Colorado Rockies Batting Statistics (non-pitchers)


```{r, echo=FALSE, message=FALSE, warning=FALSE}

burl <- 
  getURL("http://www.baseball-reference.com/teams/COL/2017.shtml#team_batting::none")

  TeamStats <- readHTMLTable(burl)
  TeamStats <- list.clean(TeamStats, fun = is.null, recursive = FALSE)
  TeamBatting <- as_tibble(TeamStats$team_batting) %>%
       separate(Name, into = c("First", "Name"), sep =" ")
TEAMB <- TeamBatting %>% 
  select(c(1,2,4,5,6,8,9,10,11,12,13,14,15,17,19,20,21,22,23)) %>%   
  filter(Rk != "Rk" & Pos != "P")
knitr::kable(TEAMB, caption = "Rockies Batting Statistics (non-pitchers).")
```


## Pythagorean Win-Loss Theorem

> The Pythagorean Win-Loss Theorem of Baseball is a creation of Bill James which relates the number of runs a team has scored (R) and surrendered (RA) to its actual winning percentage, based on the idea that runs scored compared to runs allowed is a better indicator of a team's (future) performance than a team's actual winning percentage. Feb 20, 2015

James put this formula forward with exponent of 2, thus the similarity to the actual Pythagorean Theorem.  Statisticians have postulated that an exponent of 1.81 or 1.83 better fits historical data.  Here is the generalized formula:

$$ predicted W\% = \frac{R^k}{R^k+RA^k}   $$
```{r PredWin, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
# Build Table of Pythagorean Win Predictions for 2017
PredictedWins <- tibble(
  `Wins (k=1.81)` = round(TotalR^1.81/(TotalR^1.81+TotalRA^1.81)*162),
  `Wins (k=1.83)` = round(TotalR^1.83/(TotalR^1.83+TotalRA^1.83)*162),
  `Wins (k=2.00)` = round(TotalR^2.00/(TotalR^2.00+TotalRA^2.00)*162))
```



## Rockies Predicted Season Wins using Bill James' "Pythagorean" Formula

So, using the commonly used values of k, the Rockies predicted wins for the 2017 season look good but not as good as it could be.  As the season progresses and more R/RA history is generated, we will keep an eye on these numbers.

```{r Pred, echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(PredictedWins, caption = "Predicted Wins for Entire 2017 Season")
```

\newpage

## Rockies Pitching


```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

PitchUrl <- 
  getURL("http://www.baseball-reference.com/teams/COL/2017.shtml#team_pitching::none")

  PitchStats <- readHTMLTable(PitchUrl)
  PitchStats <- list.clean(PitchStats, fun = is.null, recursive = FALSE)
  TeamPitching <- as_tibble(TeamStats$team_pitching) %>%
       separate(Name, into = c("First", "Name"), sep =" ")

  TEAMP <- TeamPitching %>%   
  filter(Rk != "Rk") %>%
  select(c(1,2, 4, 5:18))
knitr::kable(TEAMP, caption = "Rockies pitching statistics (1 of 2).")

TEAMP <- TeamPitching %>%
  filter(Rk != "Rk")  %>%
  select(c(1,2, 4, 19:30))
knitr::kable(TEAMP, caption = "Rockies pitching statistics (2 of 2).")

```

\newpage

## Topics for Future Articles

Here are a few suggestions, but I would prefer to hear from you, dear reader, on what interests you.

* pitching metrics
* What is the OPS+ statistic and how is it calculated.

Here are a couple of suggestions my children came up with:

* Survey MLB team payroll budgets.
* Survey MLB ticket prices.

Let me know what you would like to see in future articles.  Send me email at jdreed@q.com.

Yours truly,

  Jim Reed

\newpage

# Appendix


## Glossary

### Batting Statistics

| Statistic Abbreviation| Definition                          |
|-----------------------|--------------------------------------|
|*G*| number of games (participated)|
|*PA*| plate appearances |
|*AB*| at bats|
|*R*|  runs scored by player or team|
|*RA*| runs allowed |
|*H*|  hits|
|*2B*| doubles|
|*3B*| triples|
|*HR*| home runs|
|*RBI*| runs batted in|
|*BA*| batting average|
|*OBP*| on-base percentage|
|*SLG*| slugging percentage|
|*OPS*| on-base percentage plus slugging percentage|
|*OPS+*| This statistic normalizes a player's OPS.  It adjusts for small variables that might affect OPS scores (e.g., park effects). |

\newpage

### Pitching Statistics

| Pitching Statistic    | Definition                          |
|-----------------------|--------------------------------------|
|*Rk*|  Rank This is a count of the rows from top to bottom.  It is recalculated following the sorting of a column. |
|*Pos*|  Position |
|*Name*|  Player Name |
|*Age*|  Player’s age at midnight of June 30th of that year |
|*W*|  Wins |
|*L*|  Losses |
|*W-L%*|  Win-Loss Percentage W / (W + L) For players, leaders need one decision for every ten team games.  For managers, minimum to qualify for leading is 320 games. |
|*ERA*|  9 * ER / IP  |
|*G*|  Games Played or Pitched |
|*GS*|  Games Started |
|*GF*|  Games Finished |
|*CG*|  Complete Game |
|*SHO*|  Shutouts No runs allowed and a complete game. |
|*SV*|  Saves |
|*IP*|  Innings Pitched |
|*H*|  Hits/Hits Allowed |
|*R*|  Runs Scored/Allowed |
|*ER*|  Earned Runs Allowed |
|*HR*|  Home Runs Hit/Allowed |
|*BB*|  Bases on Balls/Walks |
|*IBB*|  Intentional Bases on Balls First tracked in 1955. |
|*SO*|  Strikeouts |
|*HBP*|  Times Hit by a Pitch. |
|*BK*|  Balks |
|*WP*|  Wild Pitches |
|*BF*|  Batters Faced 
|*ERA+*|  ERA+ 100*[lgERA/ERA] Adjusted to the player’s ballpark(s). |
|*FIP*|  Fielding Independent Pitching |
|*WHIP*|  (BB + H)/IP  For recent years, leaders need 1 IP per team game played |
|*H9*|  9 x H / IP For recent years, leaders need 1 IP per team game played |
|*HR9*|  9 x HR / IP For recent years, leaders need 1 IP per team game played |
|*BB9*|  9 x BB / IP For recent years, leaders need 1 IP per team game played |
|*SO9*|  9 x SO / IP For recent years, leaders need 1 IP per team game played |
|*SO/W*|  SO/W or SO/BB For recent years, pitching leaders need 1 IP per team game played. |


Run date/time: `r Sys.Date()` `r Sys.time()`
